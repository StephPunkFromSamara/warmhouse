asyncapi: 2.6.0
info:
  title: Device Events API
  version: 1.0.0
  description: События создания, обновления и удаления устройств, подписка на user.events

channels:
  device.data:
    subscribe:
      summary: Подписка на телеметрию
      message:
        $ref: '#/components/messages/SensorDataMessage'
  device.changes:
    subscribe:
      summary: Подписка на события устройств
      message:
        $ref: '#/components/messages/DeviceEvent'

SensorDataMessage:
  name: SensorDataMessage
  title: Данные с устройств
  contentType: application/json
  payload:
    $ref: '#/components/schemas/SensorData'

  DeviceEvent:
    name: DeviceChangeMessage
    title: Событие изменения устройства
    contentType: application/json
    payload:
      type: object
      properties:
        $ref: '#/components/schemas/Device'

schemas:
  SensorData:
    type: object
    properties:
      deviceId:
        type: string
        format: uuid
      timestamp:
        type: string
        format: date-time
      temperature:
        type: number
      light_level:
        type: number
      humidity:
        type: number
  Device:
    type: object
    required: [deviceId, eventType, timestamp]
    properties:
      deviceId:
        type: string
        format: uuid
      userId:
        type: string
        format: uuid
      name:
        type: string
      type:
        type: string
      locationId:
        type: string
        format: uuid
      stateDeviceId:
        type: string
        format: uuid
      registeredAt:
        type: string
        format: date-time
